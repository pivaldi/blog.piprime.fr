---
title: How this Hexo website is build and deployed ?
date: 2025-04-29 19:00:00
id: how-this-hexo-website-is-build-and-deployed
tree_view: true
description: How this Hexo website is deployed using Docker, Caddy, docker-caddy-proxy thanks to Ansible
categories:
- [EN, Tech, Configuring, Docker]
- [EN, Tech, Configuring, Ansible]
tags:
- docker
- ansible
- hexo
- makefile
- caddy
---

![Ansible deploying Hexo blog with Docker](/media/how-this-hexo-website-is-build-and-deployed/deploying-hexo-docker-ansible.webp)

[This article is available in French](/fr/how-this-hexo-website-is-build-and-deployed/)

This website is built with the [blog framework Hexo](https://hexo.io/)
and [the elegant theme NexT](https://theme-next.js.org/).  
Nothing very exceptional for nowâ€¦ ðŸ¥¸

Let see the server maintenance and the site deployment in-depth.

## Building Asymptote Pages/Posts

All the [Asymptote pages](/asymptote) and the
[Asymptote posts](/categories/tech/programming/asymptote/) comes from the
[extensive examples' Asymptote codes](https://github.com/pivaldi/asymptote-exemples)
and are auto-generated by the [the Asymptote exemples builder](https://github.com/pivaldi/asymptote-exemples-builder).  
Once the Hexo markdown files are generated, a `rsync` synchronisation is done through [this basic script](https://github.com/pivaldi/asymptote-exemples-builder/blob/master/bin/sync-to-hexo-blog.sh).

With this organization, all projects around Asymptote are separated by concept with their own
meaning, their own perimeter of use, and their specific functioning.

## Generating HTML With Docker

The deployment start by generating the static `html` files though a [NodeJS Dockerfile](https://github.com/pivaldi/blog.piprime.fr/blob/master/hexo/Dockerfile)
and a [docker-compose.yml](https://github.com/pivaldi/blog.piprime.fr/blob/master/compose.yaml) so that the command [make generate](https://github.com/pivaldi/blog.piprime.fr/blob/master/Makefile#L26)
does all the job to generate all the static `html` files.

## Serving By Caddy

Next step to deploy the blog is done by serving the `html` static files with a [Caddy](https://caddyserver.com/)
web server instance in a simple [Caddy Dockerfile](https://github.com/pivaldi/blog.piprime.fr/blob/master/caddy/Dockerfile)
though the same `docker-compose.yml` so that the command [make serve](https://github.com/pivaldi/blog.piprime.fr/blob/master/Makefile#L38)
does all the job.  
The port `4280` is defined by the environment variable `SERVER_PORT` and you can [see the Caddyfile used for my Hexo blog](https://github.com/pivaldi/blog.piprime.fr/blob/master/caddy/Caddyfile).

However, it's not enough to serve the blog in a Docker container on the port `4280`, the blog must
be available on the ports `80` and `443` for the domain `bolg.piprime.fr`Â !

## Proxying 443 to 4280 With Caddy-Docker-Proxy

On the host machine, we want to serve multiple webservice on port `80` and `443`, not on the port `4280`.  
In order to archive this, I use a
[Caddy Docker Proxy](https://github.com/lucaslorentz/caddy-docker-proxy) and the following [Docker configuration](https://github.com/pivaldi/blog.piprime.fr/blob/master/compose.yaml#L28)Â :

```
networks:
   - caddy
labels:
   caddy_0: blog.piprime.fr
   caddy_0.reverse_proxy: "{{upstreams ${SERVER_PORT}}}"
```

and, in order to temporarily redirect `www.piprime.fr` to the blog, the next linesÂ :

```
   caddy_1: www.piprime.fr
   caddy_1.redir: "https://blog.piprime.fr{uri} temporary"
```

Although the command `make deploy-caddy-docker-proxy` archive all the deployment process of this
blog, I don't want to remember where to clone the project, how update it, and what are the software
to be installed on the host (`git`, `make`, `Docker` globally on the host machine).

## Deploying/Maintaining With Ansible

When it's needed to use a new server instance, for any reason whatsoever, it's a huge pain to install all the software dependencies, make all the configurations
and proceed to all the deployment process for all the services.  
Even to update the blog, I'm tired to connect though `ssh`, go to the good directory, remember the
command to launch and ensure all was done correctly without missing a magic command hidden under
bundles.

In order to automatize all the server installation, update and maintenance, I've chosen the [Ansible software](https://www.redhat.com/en/ansible-collaborative).  
My [Ansible configuration](https://github.com/pivaldi/ansible) is so secure that I'm confidant to share itÂ !

About this blog, the only thing to do and remember is to launch the command `make piprimefr-blog`Â ;
this will ensure that most needed software are installed, properly configured and this will clone
the blog or or update it if it's needed.

- To install a new server instance or to update it, the only command to launch is `make all`Â ! 
- You can take a look to [the main Ansible task to deploy this Hexo blog](https://github.com/pivaldi/ansible/blob/master/roles/piprime.fr/tasks/blog.yml).

## Conclusion

This blog is partiality built by an automate tool (Asymptote pages and posts), served by a dockerized Caddy webserver instance herself proxyfied by Caddy Docker Proxy.  
All the server maintenance and blog deployment is done though the automation engine Ansible.
